<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Buscador de Empleados</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 700px; margin: auto; }
    h1 { text-align: center; }
    #searchContainer { text-align: center; margin-bottom: 1rem; }
    #suggestions { list-style: none; padding: 0; }
    #suggestions li { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; }
    .logo-empresa { display: block; max-width: 150px; margin: auto; }
    .silueta { width: 100px; height: 100px; }
  </style>
</head>
<body>

  <h1>Buscador de Empleados</h1>
  <div id="searchContainer">
    <input type="text" id="searchInput" placeholder="Busca un empleado..." />
    <ul id="suggestions"></ul>
  </div>
  <div id="employeeDetail"></div>

  <script>
    let allEmployees = [];

    async function loadEmployees() {
      try {
        const response = await fetch('https://raw.githubusercontent.com/LuisFer111/NetcenterRH/main/Data/empleados_final.json');
        if (!response.ok) throw new Error("No se pudo cargar el JSON.");
        const jsonData = await response.json();
        allEmployees = flattenEmployees(jsonData);
        console.log("Empleados cargados correctamente.");
      } catch (error) {
        console.error("Error cargando JSON:", error);
      }
    }

    function flattenEmployees(data) {
      let result = [];
      for (const empresa in data) {
        data[empresa].empleados.forEach(emp => result.push(emp));
      }
      return result;
    }

    function getLogoUrl(empresa) {
      return empresa === "TAFER" ? "imagenes/TAFER.png" :
             empresa === "VILLAGROUP" ? "imagenes/VILLAGROUP.png" :
             "imagenes/default.png";
    }

    function getSilhouetteUrl(gender) {
      return gender === "Mujer" ? "imagenes/siluetamujer.png" : "imagenes/siluetahombre.png";
    }

    function showEmployeeDetail(emp) {
      document.getElementById('employeeDetail').innerHTML = `
        <img class="logo-empresa" src="${getLogoUrl(emp.Empresa)}" alt="Logo Empresa">
        <h2>${emp.Nombre}</h2>
        <p><strong>Puesto:</strong> ${emp.Puesto || 'N/A'}</p>
        <p><strong>Extensión:</strong> ${emp["Extension Telefonica"] || 'N/A'}</p>
        <p><strong>Empresa:</strong> ${emp.Empresa || 'N/A'}</p>
        <p><strong>Género:</strong> ${emp.Genero || 'N/A'}</p>
        <img class="silueta" src="${getSilhouetteUrl(emp.Genero)}" alt="Silueta">
      `;
    }

    function renderSuggestions(results) {
      const suggestionsList = document.getElementById('suggestions');
      suggestionsList.innerHTML = '';
      results.forEach(emp => {
        const li = document.createElement('li');
        li.textContent = emp.Nombre;
        li.addEventListener('click', () => {
          showEmployeeDetail(emp);
          document.getElementById('searchInput').value = '';
          suggestionsList.innerHTML = '';
        });
        suggestionsList.appendChild(li);
      });
    }

    document.getElementById('searchInput').addEventListener('input', () => {
      const query = document.getElementById('searchInput').value.toLowerCase();
      if (!query) {
        document.getElementById('suggestions').innerHTML = '';
        return;
      }
      const filtered = allEmployees.filter(emp =>
        emp.Nombre.toLowerCase().includes(query) ||
        (emp["Extension Telefonica"] || '').toLowerCase().includes(query) ||
        (emp.Puesto || '').toLowerCase().includes(query)
      );
      renderSuggestions(filtered.slice(0, 10));
    });

    loadEmployees();
  </script>
</body>
</html>
